syntax = "proto3";
package ru.zveron.contract.specialist;

import "google/protobuf/wrappers.proto";
import "google/protobuf/timestamp.proto";

option swift_prefix = "";
option java_package = "ru.zveron.contract.specialist";
option java_outer_classname = "SpecialistExternalProto";
option java_multiple_files = true;

service SpecialistServiceExternal {
  // Лента специалистов
  rpc GetWaterfall (GetWaterfallRequest) returns (GetWaterfallResponse);
  // Карточка специалиста
  rpc GetCardSpecialist (google.protobuf.Int64Value) returns (CardSpecialist);
}


message GetWaterfallRequest{
  int32 page_size = 1;
  Sort sort = 2;
}


message Sort {
  enum SortBy {
    DATE = 0;
    PRICE_DESC = 1;
    PRICE_ASC = 2;
    RATING = 3;
  }

  SortBy sort_by = 1;
  // Данные последнего специалиста, который был на прошлой странице(если запрос от второй страницы и последующей)
  optional LastSpecialist last_specialist = 2;
}

message LastSpecialist {
  int64 id = 1;
  // Дата создания
  google.protobuf.Timestamp date = 2;
  int32 price = 3;
  double rating = 4;
}

message GetWaterfallResponse {
  repeated Specialist specialists = 1;

  // Данные последнего объявления, необходимые для сортировки и работы водопада
  LastSpecialist last_specialist = 2;
}

message Specialist {
  int64 id = 1;
  string name = 2;
  double rating = 3;
  int32 reviews_count = 4;
  string town = 5;
  optional Subway subway_home = 6;
  string description = 7;
  string img_url = 8;
}

message CardSpecialist {
  int64 id = 1;
  string name = 2;
  double rating = 3;
  // Количество отзывов "123 отзыва"
  string reviews_count = 4;
  // Если специалист принимает у себя
  optional Subway subway_home = 5;
  // Куда выезжает специалист, если выезжает вообще
  repeated Address addresses = 6;
  repeated Service services = 7;
  // В онлайне
  bool online = 9;
  string description = 10;
  string img_url = 11;
}


message Subway {
  string station_name = 1;
  string color = 2;
}

message Address {
  oneof Destination {
    Subway subway = 1;
    string district = 2;
  }
}

message Service {
  string name = 1;
  string price = 2;
}